---
wave: 1
depends_on: []
files_modified:
  - src/core/theory/index.ts
  - src/utils/theoryEngine.ts
autonomous: true
---

# Plan: 01.5-01 Refactor Core Theory to use Unified Engine

The goal is to make `theoryEngine.ts` the base rule by integrating it into the central `src/core/theory/index.ts` which is used across the site.

## Tasks

<task id="harmonize-core">
Update `src/core/theory/index.ts`:
- Import functional spelling logic from `theoryEngine.ts`.
- Refactor `midiToNoteName` to use `getFunctionalNoteName` internally.
- Ensure backward compatibility for existing call sites.
</task>

<task id="expand-engine">
Expand `src/utils/theoryEngine.ts` if needed to cover gaps found during core refactoring.
</task>

## Verification
- `npm test` or verify that key modules (ChordLab, EarTraining) still display notes correctly.
- Check that "outside" notes (e.g. Eb in key of C with 'iv' context) are spelled as Ab in Fm chord.
