# Research: Phase 3 â€” The Sonic Layer

## Overview

Phase 3 aims to transition the JazzKiller audio engine from basic samplers to a high-fidelity "Premium Engine" using studio stems and dynamic mixing.

## Audio Infrastructure

- **Asset Hosting**: Decision made to utilize current Cloudflare Pages hosting for audio samples as they are optimized and small. R2 is not required at this stage.
- **Current Sampler**: Uses `Tone.Sampler` with local `.m4a` files for Piano, Bass, and Drums.
- **Proposed Enhancement**:
  - Centralize audio path management in the store to ensure simple swaps.
  - Implement a dynamic mixer that controls volume and potentially effects (Reverb, EQ) for each stem.
  - Integration with `useJazzBand.ts` to support both "Live MIDI Generation" and "High-Fidelity Stems".

## UI/UX Considerations

- **Note Waterfall**: Visualization of MIDI events (either generated by AI band or played by user) moving towards a playline. This helps users visualize the "piano roll" of the band's comping.
- **Mixer Component**: Small, premium UI tray for volume sliders (separating Bass, Drums, Piano).
- **Tone Selection**: Analysis tool that looks at the harmonic richness of the microphone signal to provide feedback on "Tone Quality".

## Technical Decisions

- **Master Effects Chain**: Use `Tone.Limiter` as the last stage of the audio graph to prevent digital clipping in the browser.
- **WebAssembly/Canvas**: Use for the Note Waterfall to ensure high frame rates during playback without taxing the React render cycle.
