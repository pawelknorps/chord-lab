---
wave: 1
depends_on: []
files_modified:
  - src/utils/theoryEngine.ts
  - src/utils/theoryEngine.test.ts
autonomous: true
---

# Plan: 01-01 Create Centralized Theory Engine

The goal is to consolidate music theory logic into a single "Source of Truth" engine that handles enharmonic spelling and advanced functional analysis following jazz rules.

## Tasks

<task id="engine-init">
Create `src/utils/theoryEngine.ts` with base functional spelling logic.
- Implement `getFunctionalNoteName(midi: number, tonic: string, scale: string): string`
- Ensure sharps/flats match the selected context (e.g., F in C Major vs E# in F# Major).
</task>

<task id="jazz-rules">
Implement Jazz-specific enhancements:
- Support for Secondary Dominants spelling (e.g., V/V in C uses F#).
- Support for Modal Interchange spelling (e.g., iv in C uses Ab).
</task>

<task id="unit-tests">
Create `src/utils/theoryEngine.test.ts` with minimal verification suite.
- Test basic diatonic keys.
- Test secondary dominant enharmonics.
- Test modal interchange enharmonics.
</task>

## Verification
- `npm test src/utils/theoryEngine.test.ts` passes.
- Manual verification of spelling accuracy for C Major and F# Major contexts.
